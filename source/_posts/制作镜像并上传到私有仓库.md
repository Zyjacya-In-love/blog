---
title: 制作镜像并上传到私有仓库
date: 2016-08-17 16:50:28
tags:
  - Docker
categories:
  - Linux
---

本篇记录了Docker容器和主机如何互相拷贝传输文件, 并且制作自己的镜像, 并在 [网易蜂巢](https://c.163.com/)上创建私有仓库并上传自己制作的镜像

<!--more-->

### **数据操作**

1. `sudo docker run -i -t -d -P --name anaconda -v /home/:/home/ centos:anaconda`
    - 创建一个名字为`anaconda`的容器, 并将主机的`/home/`目录挂载到容器的`/home/`上
    - `centos:anaconda`是镜像名和标签

2. `sudo docker ps` 查看运行的容器 

3. `sudo docker attach [CONTAINER ID]`进入容器, 进入`home`目录查看文件

- 后面使用了`docker-enter`命令进入容器, 具体安装方法见 [页面底部](https://yeasy.gitbooks.io/docker_practice/content/container/enter.html)

### **创建镜像**

针对镜像做出更改, 现在有两种方法。

1. 从已经创建的容器中更新镜像，并且提交这个镜像。
2. 使用Dockerfile指令来创建一个镜像。

我们采用第一种方式, 首先在网易镜像中心`docker pull`下来centos7.0 , 然后`docker tag`重命名, 然后`docker run`创建容器, 最后`docker-enter`进入容器

### **在容器中进行python的环境部署**

安装`python环境`为例,
1. 首先安装epel扩展源 : `sudo yum -y install epel-release`

2. 然后安装python-pip : `sudo yum -y install python-pip`

3. 清除一下cache : `sudo yum clean all`

4. 安装依赖包`sudo yum install blas-devel lapack-devel`

5. 安装numpy : `pip install numpy`
6. 安装scipy : `pip install scipy`     
7. 安装scikit-learn : `pip install scikit-learn`
   
这时我们相当于把容器中的运行环境改变了, 我们要将新的环境作为自己的镜像

### **推送本地镜像到网易蜂巢**

1. 列出本地镜像`docker images`, 查看运行容器`docker ps`

2. 登录蜂巢镜像仓库 : `docker login –u [你的蜂巢邮箱帐号或手机号码] –p [你的蜂巢密码] –e [你的邮箱] hub.c.163.com`
   - 返回`「Login Succeded」`即为登录成功

3. 标记本地镜像 : `docker tag [镜像名或ID]  hub.c.163.com/[你的用户名]/[标签名]`

   - 你的蜂巢镜像仓库推送地址为 `hub.c.163.com/[你的用户名]/[标签名]`
   - 推送至不存在的镜像仓库时，自动创建镜像仓库并保存新推送的镜像版本；
   - 推送至已存在的镜像仓库时，在该镜像仓库中保存新推送的版本，当版本号相同时覆盖原有镜像。

4. 推送至蜂巢镜像仓库 : `docker push hub.c.163.com/[你的用户名]/[标签名]`


### **效果**
1. 命令`docker push hub.c.163.com/simshang/python`上传

    ![](/img/制作镜像并上传到私有仓库/docker1.JPG)

2. 网易蜂巢查看

    ![](/img/制作镜像并上传到私有仓库/docker2.JPG)






